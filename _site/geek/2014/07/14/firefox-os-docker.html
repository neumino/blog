

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
        <title>Justonepixel.com - Docker container for Firefox OS</title>
        
        <meta name="author" content="Michel">

        <!-- Enable responsive viewport -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/bootstrap/css/bootstrap.2.2.2.min.css"/>
      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/css/style.css?body=1"/>

        <!-- atom & rss feed -->
        <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
        <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    </head>

    <body>
    <div class="wrapper container">
    <div class="row">
        <div class="span1 offset1">
            <div class="navbar">
                <ul>
                    <li><a href="/"><img src="/assets/themes/justonepixel/img/home.png" /></a></li>
                    <li><a href="/about.html"><img src="/assets/themes/justonepixel/img/about.png" /></a></li>
                    <li><a href="/contact.html"><img src="/assets/themes/justonepixel/img/contact.png" /></a></li>
                    <li><a href="/archive.html"><img src="/assets/themes/justonepixel/img/archive.png" /></a></li>
                    <li><a href="/search.html"><img src="/assets/themes/justonepixel/img/search.png" /></a></li>
                    <li><a href="https://github.com/neumino"><img src="/assets/themes/justonepixel/img/github.png" /></a></li>
                    <li><a href="http://www.strava.com/athletes/1952902"><img src="/assets/themes/justonepixel/img/strava.png" /></a></li>
                    <li><a href="https://twitter.com/neumino"><img src="/assets/themes/justonepixel/img/twitter.png" /></a></li>
                    <li><a href="https://www.facebook.com/michel.tu"><img src="/assets/themes/justonepixel/img/facebook.png" /></a></li>
                    <li><a href="http://www.linkedin.com/in/tumichel"><img src="/assets/themes/justonepixel/img/linkedin.png" /></a></li>
                    <li><a href="https://plus.google.com/u/0/111745051853861893359/posts"><img src="/assets/themes/justonepixel/img/googleplus.png" /></a></li>
                </ul>
            </div>
        </div>

        <div class="span9">

            <div class="content">
                

<div class="post">
<i class="icon-post"></i>

    <h2>
        <a href="/geek/2014/07/14/firefox-os-docker" class="title">Docker container for Firefox OS</a>
        <span class="meta_info">posted on 14 July 2014</span>
    </h2>

    
<p>I recently got a <a href="https://developer.mozilla.org/en-US/Firefox_OS/Developer_phone_guide/Flame">Flame</a>, the
developer reference phone for Firefox OS.</p>

<p>I created a Docker container to build Firefox OS, mostly because I didn’t feel like installing Java 6 on my system (since it is
<a href="http://www.oracle.com/technetwork/java/eol-135779.html">not supported anymore</a>). This post is about how to build such the container.</p>

<p>If you are interested in the image, you can find it on the 
<a href="https://registry.hub.docker.com/u/neumino/ubuntu-firefoxos/">Docker’s hub</a> once <a href="https://github.com/dotcloud/docker/issues/7034">this issue</a> will be solved.</p>

<p>Start it with</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker run -t -i --privileged --expose 5037 -v /dev/bus/usb:/dev/bus/usb -v /host/data:/container/data ubuntu-firefoxos /bin/bash
</code></pre>
</div>

<p><strong>Steps to create the container:</strong></p>

<p>Start a Ubuntu container.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker run -t -i ubuntu:14.04 /bin/bash
</code></pre>
</div>

<p>Update the system.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get update
apt-get upgrade
</code></pre>
</div>

<p>Install the dependencies as described <a href="https://developer.mozilla.org/en-US/Firefox_OS/Firefox_OS_build_prerequisites#Ubuntu_13.10">in the docs</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dpkg --add-architecture i386
apt-get update
apt-get install --no-install-recommends autoconf2.13 bison bzip2 ccache curl flex gawk gcc g++ g++-multilib gcc-4.6 g++-4.6 g++-4.6-multilib git lib32ncurses5-dev lib32z1-dev zlib1g:amd64 zlib1g-dev:amd64 zlib1g:i386 zlib1g-dev:i386 libgl1-mesa-dev libx11-dev make zip libxml2-utils
apt-get install python
apt-get install android-tools-adb
update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.6 1 
update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 2 
update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.6 1 
update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 2 
update-alternatives --set gcc "/usr/bin/gcc-4.6" 
update-alternatives --set g++ "/usr/bin/g++-4.6" 
</code></pre>
</div>

<p><strong>Note</strong>: All the instructions below are what I did to be able to build the OS for the Flame. Some steps may not be required for another
phone (and some may be missing).</p>

<p>You need to specify some credential for <code class="highlighter-rouge">git</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git config --global user.email &lt;your_email&gt;
git config --global user.name &lt;your_name&gt;
</code></pre>
</div>

<p>Then you have to install a few more things to be able to build, with first Java.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>add-apt-repository ppa:webupd8team/java
apt-get update
install oracle-java6-installer
</code></pre>
</div>

<p>Building Firefox OS requires you to pull some blobs from your phone with <code class="highlighter-rouge">adb</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install android-tools-adb
apt-get install libusb-1.0-0 libusb-1.0-0-dev
apt-get install usbutils # This may not be needed, I used it to debug a few things
</code></pre>
</div>

<p>Install a few more packages required by the build process.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install dosfstools libxrender1 libasound2 libatk1.0 libice6
</code></pre>
</div>

<p>Export a <code class="highlighter-rouge">SHELL</code> variable.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export SHELL=/bin/bash
</code></pre>
</div>

<p>Install unzip.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install unzip
</code></pre>
</div>

<p>Get your container id with:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker ps -a
</code></pre>
</div>

<p>Commit your changes.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker commit &lt;container_id&gt; ubuntu-firefoxos
</code></pre>
</div>

<p>Stop and remove the container.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker stop &lt;container_id&gt;
sudo docker rm &lt;container_id&gt;
</code></pre>
</div>

<p>Restart the container with a few more flags.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker run -t -i --privileged --expose 5037 -v /dev/bus/usb:/dev/bus/usb -v /host/data:/container/data ubuntu-firefoxos /bin/bash
</code></pre>
</div>

<p>The <code class="highlighter-rouge">--privileged --expose 5037 -v /dev/bus/usb:/dev/bus/usb</code> options are required for <code class="highlighter-rouge">adb</code> to be able to find your device.</p>

<p>Before building, make sure you enable the
<a href="https://developer.mozilla.org/en-US/Firefox_OS/Debugging/Connecting_a_Firefox_OS_device_to_the_desktop">remote debugging mode</a>
on your phone.</p>

<blockquote>
  <p>Open the Settings app, then Device Information &gt; More Information &gt; Developer. <br />
In the developer menu, check “Remote debugging”.</p>
</blockquote>

<p>Then you are good to go:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /container/data/B2G
./config.sh flame
./build.sh
./flash.sh
</code></pre>
</div>


    
    <ul class="tag_box inline">
        <li><i class="icon-folder-open"></i></li>
        
        


  
     
    	<li><a href="/categories.html#Geek-ref">
    		Geek <span>43</span>
    	</a></li>
    
  


    </ul>
      

    
    <ul class="tag_box inline">
        <li><i class="icon-tags"></i></li>
        
        


  
     
    	<li><a href="/tags.html#rethinkdb-ref">rethinkdb <span>21</span></a></li>
     
    	<li><a href="/tags.html#nodejs-ref">nodejs <span>7</span></a></li>
    
  



    </ul>
      

    
    <hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog.justonepixel.com -->
<ins class="adsbygoogle"
     style="display:inline-block;width:468px;height:60px"
     data-ad-client="ca-pub-5366199723595534"
     data-ad-slot="2620298801"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    <hr>
    <div class="pagination">
        <ul>
            
            <li class="prev"><a href="/geek/2014/03/29/rethinkdbdash-for-node-stable" title="Rethinkdbdash for Node.js 0.10.26">&larr; Previous</a></li>
            
            <li><a href="/archive.html">Archive</a></li>
            
            <li class="next"><a href="/geek/2014/10/03/rethinkdb-and-coreos" title="RethinkDB and CoreOS: Navigating Digital Ocean Together">Next &rarr;</a></li>
            
        </ul>
    </div>
    <hr>
</div>


            </div>

            <footer>
                <p>Michel Tu
                &mdash;
                <a href="mailto:michel@justonepixel.com">michel@justonepixel.com</a>
                &mdash;
                <a href="http://blog.justonepixel.com">http://blog.justonepixel.com</a></p>
            </footer>

        </div>
    </div>
    </div>
    <noscript id="deferred-styles">
      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/bootstrap/css/bootstrap.2.2.2.min.css"/>
      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/css/style.css?body=1"/>
    </noscript>
    <script>
      var loadDeferredStyles = function() {
        var addStylesNode = document.getElementById("deferred-styles");
        var replacement = document.createElement("div");
        replacement.innerHTML = addStylesNode.textContent;
        document.body.appendChild(replacement)
        addStylesNode.parentElement.removeChild(addStylesNode);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(function() { window.setTimeout(loadDeferredStyles, 0); });
      else window.addEventListener('load', loadDeferredStyles);
    </script>
		
    </body>
</html>

