

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
        <title>Justonepixel.com - Blog</title>
        
        <meta name="author" content="Michel">

        <!-- Enable responsive viewport -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/bootstrap/css/bootstrap.2.2.2.min.css"/>
      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/css/style.css?body=1"/>

        <!-- atom & rss feed -->
        <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
        <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    </head>

    <body>
    <div class="wrapper container">
    <div class="row">
        <div class="span1 offset1">
            <div class="navbar">
                <ul>
                    <li><a href="/"><img src="/assets/themes/justonepixel/img/home.png" /></a></li>
                    <li><a href="/about.html"><img src="/assets/themes/justonepixel/img/about.png" /></a></li>
                    <li><a href="/contact.html"><img src="/assets/themes/justonepixel/img/contact.png" /></a></li>
                    <li><a href="/archive.html"><img src="/assets/themes/justonepixel/img/archive.png" /></a></li>
                    <li><a href="/search.html"><img src="/assets/themes/justonepixel/img/search.png" /></a></li>
                    <li><a href="https://github.com/neumino"><img src="/assets/themes/justonepixel/img/github.png" /></a></li>
                    <li><a href="http://www.strava.com/athletes/1952902"><img src="/assets/themes/justonepixel/img/strava.png" /></a></li>
                    <li><a href="https://twitter.com/neumino"><img src="/assets/themes/justonepixel/img/twitter.png" /></a></li>
                    <li><a href="https://www.facebook.com/michel.tu"><img src="/assets/themes/justonepixel/img/facebook.png" /></a></li>
                    <li><a href="http://www.linkedin.com/in/tumichel"><img src="/assets/themes/justonepixel/img/linkedin.png" /></a></li>
                    <li><a href="https://plus.google.com/u/0/111745051853861893359/posts"><img src="/assets/themes/justonepixel/img/googleplus.png" /></a></li>
                </ul>
            </div>
        </div>

        <div class="span9">

            <div class="content">
                
<div class="post">
<i class="icon-post"></i>
    <h2><a href="/geek/2016/12/24/docker-archlinux-update" class="title">Docker fails to create endpoint</a>
    <span class="meta_info">posted on 24 December 2016</span>
    </h2>
    
<p>I ran into this issue recently while trying to get tensorflow running:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>michel@xone:~$ docker run  -p 8888:8888 gcr.io/tensorflow/tensorflow
docker: Error response from daemon: failed to create endpoint high_raman on network bridge: failed to add the host (veth3c0e4fe) &lt;=&gt; sandbox (veth21faddb) pair interfaces: operation not supported.
</code></pre>
</div>

<p>Nothing looked suspicious in <code class="highlighter-rouge">ip addr</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>michel@xone:~$ ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: wlp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 8c:70:5a:ff:a4:08 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.71/24 brd 192.168.1.255 scope global dynamic wlp3s0
       valid_lft 79660sec preferred_lft 79660sec
    inet6 2602:306:ce40:a090:8e70:5aff:feff:a408/64 scope global noprefixroute dynamic 
       valid_lft 2591806sec preferred_lft 604606sec
    inet6 fe80::8e70:5aff:feff:a408/64 scope link 
       valid_lft forever preferred_lft forever
3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:d3:0f:49:9b brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 scope global docker0
       valid_lft forever preferred_lft forever
</code></pre>
</div>

<p>Looking around, it
<a href="https://github.com/docker/docker/issues/15341#issuecomment-218930712">seems</a>
that Archlinux needs to reboot for Docker to properly work. I didn’t look any
further, but at least this did the trick for me.</p>

</div>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- blog.justonepixel.com -->
<p><ins class="adsbygoogle" style="display:inline-block;width:468px;height:60px" data-ad-client="ca-pub-5366199723595534" data-ad-slot="2620298801"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<hr class="adhr" />

<div class="post">
<i class="icon-post"></i>
    <h2><a href="/geek/2016/11/09/force-update-ttf-dejavu" class="title">Force update ttf-dejavu</a>
    <span class="meta_info">posted on 09 November 2016</span>
    </h2>
    
<p>On archlinux, ttf-dejavu 2.37 requires a forced upgrade. If you don’t, you will be greeted
with this error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>michel@xone:~$ sudo pacman -S ttf-dejavu
[sudo] password for michel: 
resolving dependencies...
looking for conflicting packages...

Packages (1) ttf-dejavu-2.37-1

Total Installed Size:  9.75 MiB
Net Upgrade Size:      0.57 MiB

:: Proceed with installation? [Y/n] Y
(1/1) checking keys in keyring                                                              [########] 100%
(1/1) checking package integrity                                                            [########] 100%
(1/1) loading package files                                                                 [########] 100%
(1/1) checking for file conflicts                                                           [########] 100%
error: failed to commit transaction (conflicting files)
ttf-dejavu: /etc/fonts/conf.d/20-unhint-small-dejavu-sans-mono.conf exists in filesystem
ttf-dejavu: /etc/fonts/conf.d/20-unhint-small-dejavu-sans.conf exists in filesystem
ttf-dejavu: /etc/fonts/conf.d/20-unhint-small-dejavu-serif.conf exists in filesystem
ttf-dejavu: /etc/fonts/conf.d/57-dejavu-sans-mono.conf exists in filesystem
ttf-dejavu: /etc/fonts/conf.d/57-dejavu-sans.conf exists in filesystem
ttf-dejavu: /etc/fonts/conf.d/57-dejavu-serif.conf exists in filesystem
Errors occurred, no packages were upgraded.
</code></pre>
</div>

<p>Make sure to run pacman <code class="highlighter-rouge">-f</code> for this package.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>michel@xone:~$ sudo pacman -S --force ttf-dejavu
</code></pre>
</div>

</div>

<div class="post">
<i class="icon-post"></i>
    <h2><a href="/geek/2016/10/30/incomplete-kernel-update" class="title">Incomplete kernel update</a>
    <span class="meta_info">posted on 30 October 2016</span>
    </h2>
    
<p><em>These are quick notes about fixing my system after an incomplete kernel update.</em></p>

<p>During a system update, my workstation suddenly shut down (hardware failure). I
was working on something else during the update, so I had no idea when the
update was aborted. When I tried to boot again, I was greeted with this error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Warning: /lib/modules/4.8.4-1-ARCH/modules.devname not found - ignoring.
starting version 231
ERROR: device 'UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx' not found, Skipping fsck.
ERROR: Unable to find root device 'UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.
You are being dropped to a recovery shell
    Type 'exit' to try and continue booting
sh: can't access tty: job control turned off
[rootfs ]#
</code></pre>
</div>

<p>At that time I thought that one of my harddrive died. Digging a bit into it,
the partition that couldn’t be found was an encrypted one. So I thought that
maybe my fstab got somehow corrupted. I didn’t have access to a shell after
booting as the keyboard was not working, so I just booted with a live usb key.
My disks are all encrypted, so the first step was to decrypt them:</p>

<p>Confirm that they are indeed crypted:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>blkid | grep crypto
</code></pre>
</div>

<p>Decrypt/mount the partition:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cryptsetup luksOpen /dev/sdc2/ crypt
</code></pre>
</div>

<p>You then can’t just mount <code class="highlighter-rouge">/dev/mapper/crypt</code>. If you try, you’ll get:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mount /dev/mapper/crypthome /mnt/crypt
mount: unknown filesystem type 'LVM2_member'
</code></pre>
</div>

<p>Find the group of your volume (mine was main):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vgscan
</code></pre>
</div>

<p>Find the name of the volume (mine was root):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>lvs
</code></pre>
</div>

<p>Mount it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mount /dev/main/root /mnt
</code></pre>
</div>

<p>In my case, <code class="highlighter-rouge">/boot</code> is not encrypted, so I also had to mount it to be able to
look at my kernel.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mount /dev/sdc1 /mnt/boot
</code></pre>
</div>

<p>Then I just used chrooted:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>arch-chroot /mnt
</code></pre>
</div>

<p>I thought that the issue might have been in the initial ramdisk environment, so I just ran:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkinitcpio -p linux
</code></pre>
</div>

<p>I was greeted with quite a few warnings that some modules were not found. But
all the modules for encryption was present, so I decided to just reboot.
Some progress were made: I could decrypt my disk, but was then greeted
with:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mount: unknown filesystem type 'ext4'
</code></pre>
</div>

<p>I booted on the usb key again, and looked a bit at my modules. That’s when I found
that <code class="highlighter-rouge">uname -r</code> was giving me an old kernel version. Trying to reinstall the <code class="highlighter-rouge">linux</code>
package was returning an error because the <code class="highlighter-rouge">desc</code> file was missing. I guess my
update was interrupted during the kernel update.</p>

<p>Removing the package and re-installing it did the trick. Note that <code class="highlighter-rouge">pacman -S --force</code>
was not enougth to prevent pacman from complaining about the missing files.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacman -R linux
pacman -Sy linux
mkinitcpio -p linux
</code></pre>
</div>

</div>

<div class="post">
<i class="icon-post"></i>
    <h2><a href="/life/2016/10/08/my-rethinkdb-story" class="title">My RethinkDB story</a>
    <span class="meta_info">posted on 08 October 2016</span>
    </h2>
    
<p>RethinkDB recently <a href="https://rethinkdb.com/blog/rethinkdb-shutdown/">announced</a>
that the company behind the database is shutting down. In the last few days,
many people have started to write about RethinkDB; the
<a href="http://sagemath.blogspot.com/2016/10/rethinkdb-sagemath-andreessen-horowitz.html">article about open source companies</a>
from William Stein, author of SageCloud, is probably the most interesting.
Today, I would like to share a different story - my personal one with RethinkDB.</p>

<p>After graduating from Tsinghua (Beijing), I was looking for a new country to live in and
eventually settled on moving to California. I sent a plethora of emails and eventually
participated in a <a href="https://hackerrank.com">HackerRank</a> competition where I
ranked 17th (or was it 13th?). I then got the opportunity to interview at RethinkDB.
After a few calls, I got a job offer from RethinkDB; this was my first job.</p>

<p>My first days at RethinkDB were wonderful. We were developing on a local/shared
server because building RethinkDB is quite CPU intensive. This is how I really
learned how to quit vim. One of my most vivid memory of that time is the
day Slava asked me if we should just fork CoffeeScript (CS) after getting
bitten by another bug - This was in CS early-ish days, version 1.3.x. While we
eventually did not end up forking CS, Slava’s suggestions felt like an easy
thing to do and made me realize that while I was a good programmer, I had much
more to learn.</p>

<p>Thosee early days were also great because RethinkDB, as a NosQL database, was not
yet public. We were moving extremely fast without doing code review, while
maintaining a high code quality, thanks to a strong sense of ownership.
The web interface became more polished and the data explorer turned out amazing
once we added suggestions and auto completion.</p>

<p>Launch day was incredible. We spent the whole day just answering questions.
The feedback on the web interface was extremely positive. To this day, I still
sometime wonder if the web interface was too shiny; people did not realize
how great the database engine under the hood was. The tremendous amount of
positive feedback just fueled our passion even more. We kept working hard on
it, polishing edges, adding new features etc.</p>

<p>We had great discussions about ReQL. One of the most interesting one I can
remember was about the <code class="highlighter-rouge">group</code> command that replaced <code class="highlighter-rouge">groupedMapReduce</code>. We
all had different opinions on what would be best for our users - I wanted the
scope of chained command to be always the same as the parent. The sheer amount
of thoughts poured into ReQL made it the best query language available. Nowadays,
a little part of me cries every time I have to write a SQL query for work.</p>

<p>Jessie started to work at RethinkDB about 2 years after I joined. We had a lot
of fun. I couldn’t help but be amused when I learned that she ate a box full of
bacon for breakfast. We started to date after a few months and got engaged a
few weeks ago!</p>

<p>After about 2 years and a half, I made the hard decision to leave the team
for another company. Even though I was not employed by RethinkDB (technically
Hexagram 49 Inc), I always kept RethinkDB in my heart. I kept maintaining
rethinkdbdash and thinky, refactored reqlite to support <code class="highlighter-rouge">r.http</code> which involved
making all the internal operation asynchronous etc.</p>

<p>Horizon then came out, and boy, that was a really good project. I couldn’t help
but notice that it wasn’t gaining traction fast enough, and the sad news that
RethinkDB was shutting down eventually came out. While the company is gone, I
am convinced that the database will live beyond. This is nothing more than a new
chapter for RethinkDB and I am excited to see what will happen next.</p>

<p>Slava, Michael, all the team, I took pride in crafting part of RethinkDB, in
supporting our users, and I enjoyed every bit of sailing with all of you.
My time at RethinkDB was amazing; I have nothing but great memories from
working with all of you.</p>

</div>


            </div>

            <footer>
                <p>Michel Tu
                &mdash;
                <a href="mailto:michel@justonepixel.com">michel@justonepixel.com</a>
                &mdash;
                <a href="http://blog.justonepixel.com">http://blog.justonepixel.com</a></p>
            </footer>

        </div>
    </div>
    </div>
    <noscript id="deferred-styles">
      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/bootstrap/css/bootstrap.2.2.2.min.css"/>
      <link rel="stylesheet" type="text/css" href="/assets/themes/justonepixel/css/style.css?body=1"/>
    </noscript>
    <script>
      var loadDeferredStyles = function() {
        var addStylesNode = document.getElementById("deferred-styles");
        var replacement = document.createElement("div");
        replacement.innerHTML = addStylesNode.textContent;
        document.body.appendChild(replacement)
        addStylesNode.parentElement.removeChild(addStylesNode);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(function() { window.setTimeout(loadDeferredStyles, 0); });
      else window.addEventListener('load', loadDeferredStyles);
    </script>
		
    </body>
</html>

